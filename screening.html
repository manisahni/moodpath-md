<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assessment - MoodPath MD</title>
    <meta name="description" content="Confidential mental health assessment to determine if our services are right for you.">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="css/clinical-warmth.css?v=9">
    
    <style>
        /* Screening Specific Styles */
        .screening-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 3rem 2rem;
            min-height: 60vh;
        }
        
        /* Progress Bar */
        .progress-container {
            margin-bottom: 3rem;
        }
        
        .progress-bar {
            height: 4px;
            background: rgba(44, 95, 124, 0.1);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--ocean-blue);
            border-radius: 2px;
            transition: width 0.3s ease;
            position: absolute;
            left: 0;
            top: 0;
        }
        
        .progress-text {
            font-size: 0.875rem;
            color: var(--warm-gray);
            margin-top: 0.5rem;
            text-align: center;
        }
        
        /* Question Container */
        .question-container {
            background: white;
            border-radius: 16px;
            padding: 3rem;
            margin-bottom: 2rem;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 4px 16px rgba(44, 95, 124, 0.1);
            border: 1px solid rgba(44, 95, 124, 0.08);
        }
        
        .question-number {
            font-size: 0.875rem;
            color: var(--warm-gray);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        
        .question-text {
            font-size: 1.25rem;
            color: var(--charcoal);
            line-height: 1.6;
            margin-bottom: 2rem;
        }
        
        /* Answer Options */
        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .answer-option {
            padding: 1.5rem;
            background: var(--cream);
            border: 2px solid rgba(44, 95, 124, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
            color: var(--charcoal);
            text-align: left;
            display: block;
            width: 100%;
        }
        
        .answer-option:hover {
            border-color: var(--ocean-blue);
            background: rgba(44, 95, 124, 0.02);
            transform: translateX(4px);
        }
        
        .answer-option.selected {
            border-color: var(--ocean-blue);
            background: rgba(44, 95, 124, 0.05);
        }
        
        /* Checkbox and Radio Styles */
        .checkbox-group,
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .checkbox-item,
        .radio-item {
            display: flex;
            align-items: center;
            padding: 1.5rem;
            background: var(--cream);
            border: 2px solid rgba(44, 95, 124, 0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .checkbox-item:hover,
        .radio-item:hover {
            border-color: var(--ocean-blue);
            transform: translateX(4px);
        }
        
        .checkbox-item.selected,
        .radio-item.selected {
            border-color: var(--ocean-blue);
            background: rgba(44, 95, 124, 0.05);
        }
        
        .checkbox-item input[type="checkbox"],
        .radio-item input[type="radio"] {
            display: none;
        }
        
        .checkbox-item label,
        .radio-item label {
            cursor: pointer;
            width: 100%;
            margin: 0;
            color: var(--charcoal);
        }
        
        /* Dropdown Styles */
        .select-wrapper {
            position: relative;
        }
        
        .select-input {
            padding: 1.5rem;
            background: var(--cream);
            border: 2px solid rgba(44, 95, 124, 0.1);
            border-radius: 12px;
            font-size: 1rem;
            color: var(--charcoal);
            width: 100%;
            cursor: pointer;
            transition: border-color 0.2s ease;
            appearance: none;
        }
        
        .select-input:focus {
            outline: none;
            border-color: var(--ocean-blue);
        }
        
        /* Number Input */
        .number-input {
            padding: 1.5rem;
            background: var(--cream);
            border: 2px solid rgba(44, 95, 124, 0.1);
            border-radius: 12px;
            font-size: 1rem;
            color: var(--charcoal);
            width: 100%;
            transition: border-color 0.2s ease;
        }
        
        .number-input:focus {
            outline: none;
            border-color: var(--ocean-blue);
        }
        
        /* Navigation Buttons */
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }
        
        .nav-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: 1px solid rgba(44, 95, 124, 0.2);
            border-radius: 50px;
            color: var(--warm-gray);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }
        
        .nav-btn:hover {
            border-color: var(--warm-gray);
            color: var(--charcoal);
        }
        
        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .nav-btn.primary {
            background: var(--ocean-blue);
            color: white;
            border-color: var(--ocean-blue);
        }
        
        .nav-btn.primary:hover {
            background: var(--ocean-blue-dark);
            border-color: var(--ocean-blue-dark);
        }
        
        /* Results Section */
        .results-container {
            display: none;
            text-align: center;
            padding: 3rem;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(44, 95, 124, 0.1);
        }
        
        .results-container h2 {
            color: var(--ocean-blue);
            margin-bottom: 1.5rem;
        }
        
        .results-container p {
            color: var(--warm-gray);
            line-height: 1.8;
            margin-bottom: 2rem;
        }
        
        .results-email {
            font-size: 1.125rem;
            color: var(--ocean-blue);
            font-weight: 500;
            margin: 1.5rem 0;
        }
        
        /* Hidden by default */
        .question {
            display: none;
        }
        
        .question.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(44, 95, 124, 0.1);
            border-radius: 50%;
            border-top-color: var(--ocean-blue);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo">
                    <a href="index.html" style="text-decoration: none;">
                        <span class="logo-text">MoodPath MD</span>
                    </a>
                </div>
                <ul class="nav-menu">
                    <li><a href="about.html">About</a></li>
                    <li><a href="pricing.html">Pricing</a></li>
                    <li><a href="resources.html">Resources</a></li>
                    <li><a href="screening.html" class="btn btn-primary">Get Started</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" style="padding: calc(var(--space-2xl) + 80px) 0 var(--space-lg);">
        <div class="container">
            <div class="hero-content">
                <h1>Mental Health Assessment</h1>
                <p class="subtitle">
                    A brief, confidential screening to help us understand your needs.
                </p>
            </div>
        </div>
    </section>

    <!-- Screening Form -->
    <section>
        <div class="container">
            <div class="screening-container">
                <!-- Progress Bar -->
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressBar" style="width: 14.3%;"></div>
                    </div>
                    <div class="progress-text" id="progressText">Question 1 of 7</div>
                </div>

                <!-- Questions Container -->
                <div id="questionsContainer">
                    <!-- Question 1: Safety -->
                    <div class="question active" data-question="1">
                        <div class="question-container">
                            <div class="question-number">Question 1</div>
                            <div class="question-text">Are you currently having thoughts of ending your life or harming yourself?</div>
                            <div class="answer-options">
                                <button class="answer-option" onclick="selectAnswer(this, 'safety', 'no')">No</button>
                                <button class="answer-option" onclick="selectAnswer(this, 'safety', 'yes')">Yes</button>
                            </div>
                        </div>
                    </div>

                    <!-- Question 2: Diagnosis -->
                    <div class="question" data-question="2">
                        <div class="question-container">
                            <div class="question-number">Question 2</div>
                            <div class="question-text">Have you ever been diagnosed with any of the following?</div>
                            <div class="answer-options">
                                <div class="checkbox-group">
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'diagnosis', 'bipolar')">
                                        <input type="checkbox" name="diagnosis" value="bipolar" id="diagnosis-bipolar">
                                        <label for="diagnosis-bipolar">Bipolar disorder (manic depression)</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'diagnosis', 'schizophrenia')">
                                        <input type="checkbox" name="diagnosis" value="schizophrenia" id="diagnosis-schizophrenia">
                                        <label for="diagnosis-schizophrenia">Schizophrenia or psychosis</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'diagnosis', 'borderline')">
                                        <input type="checkbox" name="diagnosis" value="borderline" id="diagnosis-borderline">
                                        <label for="diagnosis-borderline">Borderline personality disorder</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'diagnosis', 'schizoaffective')">
                                        <input type="checkbox" name="diagnosis" value="schizoaffective" id="diagnosis-schizoaffective">
                                        <label for="diagnosis-schizoaffective">Schizoaffective disorder</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'diagnosis', 'none')">
                                        <input type="checkbox" name="diagnosis" value="none" id="diagnosis-none">
                                        <label for="diagnosis-none">None of these</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Question 3: Medications -->
                    <div class="question" data-question="3">
                        <div class="question-container">
                            <div class="question-number">Question 3</div>
                            <div class="question-text">Which best describes your experience with antidepressants?</div>
                            <div class="answer-options">
                                <button class="answer-option" onclick="selectAnswer(this, 'medications', 'none')">This is my first time seeking help</button>
                                <button class="answer-option" onclick="selectAnswer(this, 'medications', 'therapy')">I've tried therapy but no medications</button>
                                <button class="answer-option" onclick="selectAnswer(this, 'medications', '1-2')">I've tried 1-2 antidepressants</button>
                                <button class="answer-option" onclick="selectAnswer(this, 'medications', '3+')">I've tried 3 or more antidepressants</button>
                                <button class="answer-option" onclick="selectAnswer(this, 'medications', 'psychiatrist')">I'm currently seeing a psychiatrist</button>
                            </div>
                        </div>
                    </div>

                    <!-- Question 4: Medical -->
                    <div class="question" data-question="4">
                        <div class="question-container">
                            <div class="question-number">Question 4</div>
                            <div class="question-text">Do any of these currently apply to you?</div>
                            <div class="answer-options">
                                <div class="checkbox-group">
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'medical', 'pregnant')">
                                        <input type="checkbox" name="medical" value="pregnant" id="medical-pregnant">
                                        <label for="medical-pregnant">Pregnant or breastfeeding</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'medical', 'substance')">
                                        <input type="checkbox" name="medical" value="substance" id="medical-substance">
                                        <label for="medical-substance">Active alcohol or drug problem</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'medical', 'seizure')">
                                        <input type="checkbox" name="medical" value="seizure" id="medical-seizure">
                                        <label for="medical-seizure">Seizure disorder or epilepsy</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'medical', 'organ')">
                                        <input type="checkbox" name="medical" value="organ" id="medical-organ">
                                        <label for="medical-organ">Severe heart, liver, or kidney disease</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'medical', 'eating')">
                                        <input type="checkbox" name="medical" value="eating" id="medical-eating">
                                        <label for="medical-eating">Currently in eating disorder treatment</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'medical', 'none')">
                                        <input type="checkbox" name="medical" value="none" id="medical-none">
                                        <label for="medical-none">None of these apply</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Question 5: Requirements -->
                    <div class="question" data-question="5">
                        <div class="question-container">
                            <div class="question-number">Question 5</div>
                            <div class="question-text">For safe treatment, please confirm you can provide:</div>
                            <div class="answer-options">
                                <div class="checkbox-group">
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'requirements', 'contact')">
                                        <input type="checkbox" name="requirements" value="contact" id="requirements-contact">
                                        <label for="requirements-contact">An emergency contact person who can be reached if needed</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'requirements', 'pcp')">
                                        <input type="checkbox" name="requirements" value="pcp" id="requirements-pcp">
                                        <label for="requirements-pcp">Willingness to establish primary care within 60 days (if you don't have a PCP)</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'requirements', 'space')">
                                        <input type="checkbox" name="requirements" value="space" id="requirements-space">
                                        <label for="requirements-space">Private, quiet space for video appointments</label>
                                    </div>
                                    <div class="checkbox-item" onclick="toggleCheckbox(this, 'requirements', 'internet')">
                                        <input type="checkbox" name="requirements" value="internet" id="requirements-internet">
                                        <label for="requirements-internet">Reliable internet connection for telehealth</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Question 6: Demographics -->
                    <div class="question" data-question="6">
                        <div class="question-container">
                            <div class="question-number">Question 6</div>
                            <div class="question-text">Please provide your age and state:</div>
                            <div class="answer-options">
                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; color: var(--warm-gray);">Your Age:</label>
                                    <input type="number" class="number-input" id="age" min="18" max="75" placeholder="Enter your age" onkeyup="checkDemographics()">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 0.5rem; color: var(--warm-gray);">Current State:</label>
                                    <div class="select-wrapper">
                                        <select class="select-input" id="state" onchange="checkDemographics()">
                                            <option value="">Please select your state...</option>
                                            <option value="CA">California</option>
                                            <option value="NY">New York</option>
                                            <option value="TX">Texas</option>
                                            <option value="FL">Florida</option>
                                            <option value="IL">Illinois</option>
                                            <option value="PA">Pennsylvania</option>
                                            <option value="AZ">Arizona</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Question 7: Concern -->
                    <div class="question" data-question="7">
                        <div class="question-container">
                            <div class="question-number">Question 7</div>
                            <div class="question-text">What brings you here today?</div>
                            <div class="answer-options">
                                <button class="answer-option" onclick="selectAnswer(this, 'concern', 'work-stress')">Work stress or burnout</button>
                                <button class="answer-option" onclick="selectAnswer(this, 'concern', 'depression')">Depression or low mood</button>
                                <button class="answer-option" onclick="selectAnswer(this, 'concern', 'anxiety')">Anxiety or excessive worry</button>
                                <button class="answer-option" onclick="selectAnswer(this, 'concern', 'sleep')">Sleep problems affecting my mood</button>
                                <button class="answer-option" onclick="selectAnswer(this, 'concern', 'relationship')">Relationship or life transitions</button>
                                <button class="answer-option" onclick="selectAnswer(this, 'concern', 'other')">Other mood concerns</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results -->
                <div class="results-container" id="resultsContainer">
                    <h2 id="resultTitle">Assessment Complete</h2>
                    <p id="resultMessage">Thank you for completing the assessment.</p>
                    <p id="resultSubMessage">Our board-certified physician specializes in treating mild to moderate depression and anxiety through personalized, online care.</p>
                    <div class="results-email" id="resultEmail" style="display: none;">scheduling@moodpathmd.com</div>
                    <a href="#" class="btn btn-primary" id="resultButton" style="margin-top: 1.5rem;">Next Steps</a>
                </div>

                <!-- Navigation -->
                <div class="navigation" id="navigation">
                    <button class="nav-btn" onclick="previousQuestion()" id="prevBtn" disabled>Previous</button>
                    <button class="nav-btn primary" onclick="nextQuestion()" id="nextBtn" style="display: none;">Next</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p style="text-align: center; color: var(--warm-gray); font-size: 0.875rem;">
                If you're in crisis, please call 988 immediately.
            </p>
        </div>
    </footer>

    <script>
        // ================================================
        // CONFIGURATION
        // ================================================
        const CONFIG = {
            // Google Apps Script Web App URL
            googleScriptUrl: 'YOUR_GOOGLE_SCRIPT_URL_HERE', // Replace with your deployed script URL
            
            // Practice info
            practiceEmail: 'scheduling@moodpathmd.com',
            practicePhone: '(555) 555-5555',
            launchDate: 'January 2025',
            
            // States licensed in
            statesLicensed: ['CA', 'NY', 'TX', 'FL', 'IL', 'PA', 'AZ']
        };

        // ================================================
        // GLOBAL VARIABLES
        // ================================================
        let currentQuestion = 1;
        const totalQuestions = 7;
        const formData = {
            safety: null,
            diagnosis: [],
            medications: null,
            medical: [],
            requirements: [],
            age: null,
            state: null,
            concern: null
        };

        // ================================================
        // SCREENING EVALUATION LOGIC
        // ================================================
        class ScreeningEvaluator {
            constructor(data) {
                this.data = data;
                this.result = this.evaluate();
            }
            
            evaluate() {
                // Safety check - highest priority
                if (this.data.safety === 'yes') {
                    return {
                        status: 'REJECTED',
                        reason: 'Safety risk',
                        title: 'Your Safety is Our Priority',
                        message: 'Based on your responses, we strongly recommend immediate support.',
                        subMessage: 'Please call 988 for the Suicide & Crisis Lifeline or visit your nearest emergency room.',
                        buttonText: 'Call 988 Now',
                        buttonAction: 'tel:988'
                    };
                }
                
                // Diagnosis check
                const diagnosis = this.data.diagnosis || [];
                if (diagnosis.includes('bipolar') || 
                    diagnosis.includes('schizophrenia') || 
                    diagnosis.includes('borderline') ||
                    diagnosis.includes('schizoaffective')) {
                    return {
                        status: 'REJECTED',
                        reason: 'Psychiatric complexity',
                        title: 'Specialized Care Recommended',
                        message: 'Based on your responses, you may benefit from specialized psychiatric care.',
                        subMessage: 'We recommend consulting with a psychiatrist who can provide comprehensive treatment for complex conditions.',
                        buttonText: 'Find a Psychiatrist',
                        buttonAction: 'https://www.psychologytoday.com/us/psychiatrists'
                    };
                }
                
                // Medication history check
                if (this.data.medications === '3+' || 
                    this.data.medications === 'psychiatrist') {
                    return {
                        status: 'REJECTED',
                        reason: 'Treatment complexity',
                        title: 'Specialized Care Recommended',
                        message: 'Your treatment history suggests you would benefit most from psychiatric care.',
                        subMessage: 'A psychiatrist can provide advanced medication management and specialized treatment options.',
                        buttonText: 'Find a Psychiatrist',
                        buttonAction: 'https://www.psychologytoday.com/us/psychiatrists'
                    };
                }
                
                // Medical conditions check
                const medical = this.data.medical || [];
                if (medical.length > 0 && !medical.includes('none')) {
                    return {
                        status: 'REJECTED',
                        reason: 'Medical complexity',
                        title: 'Medical Consultation Needed',
                        message: 'Your medical conditions require specialized care coordination.',
                        subMessage: 'Please consult with your primary care physician or a specialist who can safely manage both your medical and mental health needs.',
                        buttonText: 'Find Medical Care',
                        buttonAction: 'https://www.zocdoc.com'
                    };
                }
                
                // Requirements check
                const requirements = this.data.requirements || [];
                if (!requirements.includes('contact')) {
                    return {
                        status: 'CONDITIONAL',
                        reason: 'Missing requirements',
                        title: 'Additional Requirements Needed',
                        message: 'For your safety, we require all patients to have an emergency contact.',
                        subMessage: 'Please arrange for an emergency contact person before proceeding with treatment.',
                        buttonText: 'Learn More',
                        buttonAction: 'faq.html'
                    };
                }
                
                // Age check
                const age = parseInt(this.data.age);
                if (age < 18 || age > 75) {
                    return {
                        status: 'REJECTED',
                        reason: 'Age outside range',
                        title: 'Age Requirements',
                        message: age < 18 ? 'We currently treat adults 18 and older.' : 'Patients over 75 require specialized geriatric care.',
                        subMessage: 'Please consult with an appropriate specialist for your age group.',
                        buttonText: 'Find Appropriate Care',
                        buttonAction: 'https://www.psychologytoday.com'
                    };
                }
                
                // State check
                if (!CONFIG.statesLicensed.includes(this.data.state)) {
                    return {
                        status: 'REJECTED',
                        reason: 'Not licensed in state',
                        title: 'Not Available in Your State',
                        message: `We're not yet licensed to practice in your state.`,
                        subMessage: 'We're working on expanding. Please check back or find local care options.',
                        buttonText: 'Find Local Care',
                        buttonAction: 'https://www.psychologytoday.com'
                    };
                }
                
                // APPROVED
                return {
                    status: 'APPROVED',
                    reason: 'Meets all criteria',
                    title: 'You're a Good Fit!',
                    message: 'Based on your responses, MoodPath MD can help with your mental health needs.',
                    subMessage: `We're currently building our practice and accepting patients for ${CONFIG.launchDate}. Email us to join the waitlist:`,
                    buttonText: 'View Pricing',
                    buttonAction: 'pricing.html',
                    showEmail: true
                };
            }
        }

        // ================================================
        // UI FUNCTIONS
        // ================================================
        function selectRadio(event, element, field, value) {
            // Prevent label from triggering twice
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // Clear previous selection
            document.querySelectorAll('.radio-item').forEach(item => {
                if (item.querySelector(`[name="${field}"]`)) {
                    item.classList.remove('selected');
                    item.querySelector('input').checked = false;
                }
            });
            
            // Set new selection
            element.classList.add('selected');
            const input = element.querySelector('input');
            if (input) {
                input.checked = true;
            }
            formData[field] = value;
            
            // Show next button
            document.getElementById('nextBtn').style.display = 'block';
            
            console.log('Selected:', field, value); // Debug log
        }

        function toggleCheckbox(element, field, value) {
            const input = element.querySelector('input');
            const isChecked = !input.checked;
            
            // Handle "none" option
            if (value === 'none' && isChecked) {
                // Uncheck all others
                document.querySelectorAll(`[name="${field}"]`).forEach(cb => {
                    if (cb.value !== 'none') {
                        cb.checked = false;
                        cb.parentElement.classList.remove('selected');
                    }
                });
                formData[field] = ['none'];
            } else if (value !== 'none' && isChecked) {
                // Uncheck "none" if selecting others
                const noneCheckbox = document.querySelector(`[name="${field}"][value="none"]`);
                if (noneCheckbox) {
                    noneCheckbox.checked = false;
                    noneCheckbox.parentElement.classList.remove('selected');
                }
                
                // Update array
                if (!formData[field]) formData[field] = [];
                formData[field] = formData[field].filter(v => v !== 'none');
                if (!formData[field].includes(value)) {
                    formData[field].push(value);
                }
            } else {
                // Remove from array
                if (formData[field]) {
                    formData[field] = formData[field].filter(v => v !== value);
                }
            }
            
            // Toggle visual state
            input.checked = isChecked;
            element.classList.toggle('selected', isChecked);
            
            // Show next button if at least one selected
            const hasSelection = formData[field] && formData[field].length > 0;
            document.getElementById('nextBtn').style.display = hasSelection ? 'block' : 'none';
        }

        function selectAnswer(button, field, value) {
            console.log('selectAnswer called:', field, value); // Debug
            
            // Remove previous selection
            button.parentElement.querySelectorAll('.answer-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selection
            button.classList.add('selected');
            formData[field] = value;
            
            // Show next button
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.style.display = 'block';
                console.log('Next button should be visible now');
            } else {
                console.error('Next button not found!');
            }
        }

        function checkDemographics() {
            const age = document.getElementById('age').value;
            const state = document.getElementById('state').value;
            
            formData.age = age;
            formData.state = state;
            
            // Show next button if both filled
            if (age && state) {
                document.getElementById('nextBtn').style.display = 'block';
            } else {
                document.getElementById('nextBtn').style.display = 'none';
            }
        }

        function nextQuestion() {
            if (currentQuestion < totalQuestions) {
                // Hide current question
                document.querySelector(`[data-question="${currentQuestion}"]`).classList.remove('active');
                
                // Show next question
                currentQuestion++;
                document.querySelector(`[data-question="${currentQuestion}"]`).classList.add('active');
                
                // Update progress
                updateProgress();
                
                // Enable previous button
                document.getElementById('prevBtn').disabled = false;
                
                // Check if answer exists for this question
                checkExistingAnswer();
                
                // Update button text for last question
                if (currentQuestion === totalQuestions) {
                    document.getElementById('nextBtn').textContent = 'Submit';
                }
            } else {
                // Submit screening
                submitScreening();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 1) {
                // Hide current question
                document.querySelector(`[data-question="${currentQuestion}"]`).classList.remove('active');
                
                // Show previous question
                currentQuestion--;
                document.querySelector(`[data-question="${currentQuestion}"]`).classList.add('active');
                
                // Update progress
                updateProgress();
                
                // Always show next button when going back
                document.getElementById('nextBtn').style.display = 'block';
                
                // Reset button text
                document.getElementById('nextBtn').textContent = 'Next';
                
                // Disable previous button if at start
                if (currentQuestion === 1) {
                    document.getElementById('prevBtn').disabled = true;
                }
            }
        }

        function checkExistingAnswer() {
            // Hide next button by default
            document.getElementById('nextBtn').style.display = 'none';
            
            // Check if current question has an answer
            switch(currentQuestion) {
                case 1: // Safety
                    if (formData.safety) {
                        document.getElementById('nextBtn').style.display = 'block';
                    }
                    break;
                case 2: // Diagnosis
                    if (formData.diagnosis && formData.diagnosis.length > 0) {
                        document.getElementById('nextBtn').style.display = 'block';
                    }
                    break;
                case 3: // Medications
                    if (formData.medications) {
                        document.getElementById('nextBtn').style.display = 'block';
                    }
                    break;
                case 4: // Medical
                    if (formData.medical && formData.medical.length > 0) {
                        document.getElementById('nextBtn').style.display = 'block';
                    }
                    break;
                case 5: // Requirements
                    if (formData.requirements && formData.requirements.length > 0) {
                        document.getElementById('nextBtn').style.display = 'block';
                    }
                    break;
                case 6: // Demographics
                    if (formData.age && formData.state) {
                        document.getElementById('nextBtn').style.display = 'block';
                    }
                    break;
                case 7: // Concern
                    if (formData.concern) {
                        document.getElementById('nextBtn').style.display = 'block';
                    }
                    break;
            }
        }

        function updateProgress() {
            const progress = (currentQuestion / totalQuestions) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Question ${currentQuestion} of ${totalQuestions}`;
        }

        function submitScreening() {
            // Show loading state
            document.getElementById('nextBtn').innerHTML = '<span class="loading"></span>';
            document.getElementById('nextBtn').disabled = true;
            
            // Evaluate screening
            const evaluator = new ScreeningEvaluator(formData);
            const evaluation = evaluator.result;
            
            // Add metadata
            const submissionData = {
                ...formData,
                timestamp: new Date().toISOString(),
                evaluationStatus: evaluation.status,
                evaluationReason: evaluation.reason,
                userAgent: navigator.userAgent,
                referrer: document.referrer || 'Direct'
            };
            
            // Submit to Google Sheets if configured
            if (CONFIG.googleScriptUrl && CONFIG.googleScriptUrl !== 'YOUR_GOOGLE_SCRIPT_URL_HERE') {
                fetch(CONFIG.googleScriptUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(submissionData)
                }).catch(error => {
                    console.error('Submission error:', error);
                });
            }
            
            // Show results
            showResults(evaluation);
        }

        function showResults(evaluation) {
            // Hide questions and navigation
            document.getElementById('questionsContainer').style.display = 'none';
            document.getElementById('navigation').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            
            // Update results content
            document.getElementById('resultTitle').textContent = evaluation.title;
            document.getElementById('resultMessage').textContent = evaluation.message;
            document.getElementById('resultSubMessage').textContent = evaluation.subMessage;
            
            // Handle email display
            if (evaluation.showEmail) {
                document.getElementById('resultEmail').style.display = 'block';
                document.getElementById('resultEmail').textContent = CONFIG.practiceEmail;
            } else {
                document.getElementById('resultEmail').style.display = 'none';
            }
            
            // Update button
            const button = document.getElementById('resultButton');
            button.textContent = evaluation.buttonText;
            if (evaluation.buttonAction.startsWith('http') || evaluation.buttonAction.startsWith('tel:')) {
                button.href = evaluation.buttonAction;
            } else {
                button.href = evaluation.buttonAction;
            }
            
            // Show results
            document.getElementById('resultsContainer').style.display = 'block';
            
            // Store in session if approved
            if (evaluation.status === 'APPROVED') {
                sessionStorage.setItem('screening_passed', 'true');
                sessionStorage.setItem('screening_responses', JSON.stringify(formData));
            }
        }

        // ================================================
        // INITIALIZATION
        // ================================================
        document.addEventListener('DOMContentLoaded', function() {
            // Show first question
            document.querySelector('[data-question="1"]').classList.add('active');
            
            // Initialize progress
            updateProgress();
            
            // Disable previous button initially
            document.getElementById('prevBtn').disabled = true;
            
            // Hide next button initially (will show when answer is selected)
            document.getElementById('nextBtn').style.display = 'none';
            
            console.log('Screening form initialized');
        });
    </script>
</body>
</html>