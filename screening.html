<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Safety Check - MoodPath MD</title>
    <meta name="description" content="Quick safety check to ensure you receive the right level of care.">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="css/minimalist.css">
    
    <style>
        .error-message {
            display: none;
            color: #dc2626;
            margin-top: 1rem;
        }
        .error-message.show {
            display: block;
        }
        .result-container {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-wrapper">
                <div class="logo">
                    <a href="index.html" style="text-decoration: none;">
                        <span class="logo-text">MoodPath MD</span>
                    </a>
                </div>
                <ul class="nav-menu">
                    <li><a href="about.html">About</a></li>
                    <li><a href="pricing.html">Pricing</a></li>
                    <li><a href="resources.html">Resources</a></li>
                    <li><a href="safety-check-final.html" class="btn btn-primary">Get Started</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <!-- Safety Check Card -->
                <div id="safetyCheck">
                    <h1>Quick Safety Check</h1>

                    <p>Our clinic provides straightforward SSRI/SNRI care for mild–moderate depression/anxiety.</p>
                    
                    <p><strong>Please confirm:</strong></p>

                    <div style="margin: 2rem 0;">
                        <label style="display: flex; align-items: flex-start; margin-bottom: 1.5rem; cursor: pointer;" onclick="toggleCheckbox('none')">
                            <input type="checkbox" id="noneApply" name="noneApply" style="margin-right: 1rem; margin-top: 0.25rem;">
                            <span>
                                <strong>None of the following apply:</strong><br>
                                Recent suicidal thoughts/plans; history of mania/hypomania; hallucinations/delusions; 
                                pregnancy/breastfeeding; daily alcohol/drug use or treatment in past year; 
                                MAOI/linezolid/IV methylene blue in last 14 days; long-QT/serious rhythm or pimozide; 
                                advanced liver/kidney disease, uncontrolled seizures, or low sodium in last year; 
                                currently on 2+ psych meds or failed 2+ antidepressants; under 18; 
                                seeking benzodiazepines/stimulants.
                            </span>
                        </label>
                        
                        <label style="display: flex; align-items: flex-start; margin-bottom: 1.5rem; cursor: pointer;" onclick="toggleCheckbox('crisis')">
                            <input type="checkbox" id="crisisAware" name="crisisAware" style="margin-right: 1rem; margin-top: 0.25rem;">
                            <span><strong>I understand</strong> this clinic is not for emergencies; if in crisis I will call 988.</span>
                        </label>
                    </div>

                    <div id="emailSection" style="display: none; margin: 2rem 0;">
                        <label><strong>Your email address:</strong></label><br>
                        <input type="email" id="emailInput" name="email" 
                               placeholder="name@example.com"
                               onkeyup="validateEmail()"
                               style="width: 100%; padding: 0.75rem; margin-top: 0.5rem; font-size: 1rem;"
                               required>
                        <br><small style="color: #666;">We'll send you a registration link within 24 hours</small>
                    </div>

                    <div class="error-message" id="errorMessage">Please complete all required fields</div>

                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-primary" id="continueBtn" onclick="handleContinue()" disabled>
                            Submit Safety Check
                        </button>
                    </div>
                </div>
            </div>

                <!-- Success Screen -->
                <div class="result-container" id="successScreen">
                    <div class="success-icon">✓</div>
                    <h2>Thank You!</h2>
                    <p>Your safety check has been submitted successfully.</p>
                    
                    <div class="info-box">
                        <p style="margin: 0 0 1rem 0; font-weight: 500; color: var(--charcoal);">
                            What happens next:
                        </p>
                        <ul style="margin: 0; padding-left: 1.5rem; color: var(--warm-gray); line-height: 1.8;">
                            <li>You'll receive an email within 24 hours</li>
                            <li>The email will contain your registration link</li>
                            <li>Complete registration to book your first appointment</li>
                        </ul>
                    </div>

                    <div class="refill-policy">
                        <h3>Our Refill Policy</h3>
                        <p>
                            We use short follow-ups to keep you safe and comfortable. 
                            Most patients receive 30-day supplies, with a check-in at 4–6 weeks 
                            and then every 3 months once stable.
                        </p>
                    </div>
                    
                    <p style="font-size: 0.9rem; color: var(--warm-gray);">
                        Please check your spam folder if you don't see our email.<br>
                        Questions? Email us at <a href="mailto:scheduling@moodpathmd.com" style="color: var(--ocean-blue);">scheduling@moodpathmd.com</a>
                    </p>
                </div>

                <!-- Not Eligible Screen -->
                <div class="result-container" id="notEligible">
                    <h2>You Deserve the Right Level of Support</h2>
                    <p>
                        Your answers suggest you'd benefit from a higher level of support. 
                        If you're in crisis, call 988 now. Otherwise, please contact your 
                        primary care clinician or a local psychiatry clinic for next-step care. 
                        We're rooting for you.
                    </p>
                    
                    <a href="tel:988" class="crisis-button">
                        Call 988 - Crisis Lifeline
                    </a>
                    
                    <div style="margin-top: 2rem;">
                        <p style="font-size: 0.95rem; color: var(--warm-gray);">
                            Other resources that may help:
                        </p>
                        <div style="margin-top: 1rem;">
                            <a href="https://www.psychologytoday.com/us/psychiatrists" 
                               target="_blank" 
                               style="display: inline-block; margin: 0.5rem; padding: 0.75rem 1.5rem; 
                                      background: var(--cream); border: 2px solid rgba(44, 95, 124, 0.1); 
                                      border-radius: 50px; text-decoration: none; color: var(--charcoal);
                                      transition: all 0.2s ease;">
                                Find a Psychiatrist
                            </a>
                            <a href="https://www.zocdoc.com" 
                               target="_blank"
                               style="display: inline-block; margin: 0.5rem; padding: 0.75rem 1.5rem; 
                                      background: var(--cream); border: 2px solid rgba(44, 95, 124, 0.1); 
                                      border-radius: 50px; text-decoration: none; color: var(--charcoal);
                                      transition: all 0.2s ease;">
                                Find Primary Care
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p style="text-align: center; color: var(--warm-gray); font-size: 0.875rem;">
                If you're in crisis, please call 988 immediately for 24/7 support.
            </p>
        </div>
    </footer>

    <script>
        // Configuration - UPDATE THESE WITH YOUR GOOGLE FORM VALUES
        const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/YOUR_FORM_ID/formResponse';
        const EMAIL_FIELD_NAME = 'entry.1234567890'; // Your email field entry ID
        const TIMESTAMP_FIELD_NAME = 'entry.0987654321'; // Your timestamp field entry ID
        const STATUS_FIELD_NAME = 'entry.1122334455'; // Your status field entry ID
        
        // Track checkbox states
        let checkboxStates = {
            none: false,
            crisis: false
        };

        // Toggle checkbox function
        function toggleCheckbox(type) {
            const checkbox = type === 'none' ? document.getElementById('noneApply') : document.getElementById('crisisAware');
            
            // If clicking on the checkbox itself, let default behavior handle it
            if (event.target.type === 'checkbox') {
                checkboxStates[type] = event.target.checked;
            } else {
                // If clicking on item or label, toggle the checkbox
                checkbox.checked = !checkbox.checked;
                checkboxStates[type] = checkbox.checked;
            }
            
            // If unchecking "none apply", show not eligible
            if (type === 'none' && !checkboxStates.none && checkboxStates.crisis) {
                showNotEligible();
                return;
            }
            
            // Update UI
            updateContinueButton();
        }

        // Update continue button state
        function updateContinueButton() {
            const continueBtn = document.getElementById('continueBtn');
            const emailSection = document.getElementById('emailSection');
            const emailInput = document.getElementById('emailInput');
            
            if (checkboxStates.none && checkboxStates.crisis) {
                // Show email section
                emailSection.style.display = 'block';
                
                // Enable button only if email is valid
                if (emailInput.value && emailInput.validity.valid) {
                    continueBtn.disabled = false;
                } else {
                    continueBtn.disabled = true;
                }
            } else {
                // Hide email section and disable button
                emailSection.style.display = 'none';
                continueBtn.disabled = true;
            }
        }
        
        // Validate email
        function validateEmail() {
            const emailInput = document.getElementById('emailInput');
            const continueBtn = document.getElementById('continueBtn');
            
            if (checkboxStates.none && checkboxStates.crisis && emailInput.value && emailInput.validity.valid) {
                continueBtn.disabled = false;
            } else {
                continueBtn.disabled = true;
            }
        }

        // Handle continue button click
        async function handleContinue() {
            const noneApply = document.getElementById('noneApply').checked;
            const crisisAware = document.getElementById('crisisAware').checked;
            const emailInput = document.getElementById('emailInput');
            const errorMessage = document.getElementById('errorMessage');
            const continueBtn = document.getElementById('continueBtn');
            
            if (!noneApply || !crisisAware || !emailInput.value) {
                errorMessage.classList.add('show');
                return;
            }
            
            // Disable button and show loading
            continueBtn.disabled = true;
            continueBtn.textContent = 'Submitting...';
            
            // Submit ONLY email to Google Forms (no health data)
            const formData = new FormData();
            formData.append(EMAIL_FIELD_NAME, emailInput.value);
            formData.append(TIMESTAMP_FIELD_NAME, new Date().toISOString());
            formData.append(STATUS_FIELD_NAME, 'Eligible');
            
            try {
                // Submit to Google Forms
                await fetch(GOOGLE_FORM_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                });
                
                // Show success screen
                document.getElementById('safetyCheck').style.display = 'none';
                document.getElementById('successScreen').style.display = 'block';
                
            } catch (error) {
                console.error('Submission error:', error);
                errorMessage.textContent = 'There was an error. Please try again.';
                errorMessage.classList.add('show');
                continueBtn.disabled = false;
                continueBtn.textContent = 'Submit Safety Check';
            }
        }

        // Show not eligible screen
        function showNotEligible() {
            document.getElementById('safetyCheck').style.display = 'none';
            document.getElementById('notEligible').style.display = 'block';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Add direct event listeners
            document.getElementById('noneApply').addEventListener('change', function() {
                checkboxStates.none = this.checked;
                if (!this.checked && checkboxStates.crisis) {
                    showNotEligible();
                } else {
                    updateContinueButton();
                }
            });
            
            document.getElementById('crisisAware').addEventListener('change', function() {
                checkboxStates.crisis = this.checked;
                updateContinueButton();
            });
        });
    </script>
</body>
</html>